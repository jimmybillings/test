<div class="app" #target>
  <header [ngClass]="{
    'fixed': (uiState.data | async).showFixed,
    'collection-tray-closed': !(preferences.data | async).collectionTrayIsOpen,
    'search-closed': !(preferences.data | async).searchIsOpen
    }" class="app-header">
    <app-nav
      [UiState]="uiState"
      [currentUser]="currentUser"
      [permission]="permission"
      [state]="state"
      [prefs]="preferences"
      [config]="(uiConfig.get('header') | async).config"
      [collection]="activeCollection.data | async"
      [cartSize]="(cartSummary.data | async).itemCount"
      (onLogOut)="logout()">
    </app-nav>
    <collection-tray
      *ngIf="(uiState.data | async).searchBarIsActive && permission.has('ViewCollections')"
      [UiState]="uiState"
      [uiConfig]="uiConfig"
      >
    </collection-tray>
    <wz-search-box
      *ngIf="(uiState.data | async).searchBarIsActive"
      [currentUser]="currentUser"
      [state]="state"
      [UiState]="uiState"
      [prefs]="preferences"
      [config]="(uiConfig.get('searchBox') | async).config"
      (searchContext)="newSearchContext($event)">
    </wz-search-box>
    <md-progress-bar mode="indeterminate" *ngIf="(uiState.data | async).loading"></md-progress-bar>
  </header>
  <div [ngClass]="{
    'collection-tray-closed': !(preferences.data | async).collectionTrayIsOpen,
    'search-closed': !(preferences.data | async).searchIsOpen
    }" class="main-content">
    <router-outlet></router-outlet>
  </div>
  <app-footer
    [currentUser]="currentUser"
    [supportedLanguages]="supportedLanguages"
    (onChangeLang)="changeLang($event)">
  </app-footer>
</div>
